<!DOCTYPE html>

<html>

<head>
<style>
    body {
        /* set margin to 0 and overflow to hidden, to go fullscreen */
        margin: 0;
        overflow: hidden;
        background-color: #000000;
    }
</style>

<title>Physijs Constraints</title>

<script type="text/javascript" src="three.js"></script>
<script type="text/javascript" src="stats.js"></script>
<script type="text/javascript" src="physi.js"></script>
<script type="text/javascript" src="dat.gui.js"></script>
<script type="text/javascript" src="chroma.js"></script>
<script type="text/javascript" src="TrackballControls.js"></script>
<script type="text/javascript" src="perlin.js"></script>
<script type="text/javascript" src="OrbitControls.js"></script>
<script type="text/javascript" src="RollControls.js"></script>
<script type="text/javascript" charset="utf-8" src="OBJMTLLoader.js"></script>
<script type="text/javascript" charset="utf-8" src="MTLLoader.js"></script>


<script type="text/javascript">

'use strict';

Physijs.scripts.worker = 'physijs_worker.js';
Physijs.scripts.ammo = 'ammo.js';

var scale = chroma.scale(['white', 'blue', 'red', 'yellow','green']);
var windowHalfX = window.innerWidth / 2;
var windowHalfY = window.innerHeight / 2;

var initScene, render, applyForce, setMousePosition, mouse_position,
        ground_material, box_material,velocity ,wheelAngle , car, mouseX,mouseY,
        clock,orbitControls,delta,rollControls,
        projector, renderer, render_stats, physics_stats, scene, ground, light, camera, box, boxes = [],vehicle_body, vehicle,input;

var obj_model = [];

initScene = function () {
    projector = new THREE.Projector;

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);

    renderer.setClearColorHex(0x000000);
    renderer.shadowMapEnabled = true;


    document.getElementById('viewport').appendChild(renderer.domElement);

    render_stats = new Stats();
    render_stats.domElement.style.position = 'absolute';
    render_stats.domElement.style.top = '1px';
    render_stats.domElement.style.left = '1px';
    render_stats.domElement.style.zIndex = 100;
    document.getElementById('viewport').appendChild(render_stats.domElement);


    scene = new Physijs.Scene({reportSize: 10, fixedTimeStep: 1 / 60});

    scene.setGravity(new THREE.Vector3(0, -80, 0));

    camera = new THREE.PerspectiveCamera(
            35,
            window.innerWidth / window.innerHeight,
            1,
            1000
    );
    //camera.position.set(190, 190, 190);
    //camera.lookAt(new THREE.Vector3(0, 0, 0));
    scene.add(camera);

    // Light
    light = new THREE.DirectionalLight(0xFFFFFF,1);
    var light1 = new THREE.AmbientLight(0xffffff);
    light.position.set(-1200, 3000, -1000);
    light.castShadow = true;
    light.shadowMapDebug = true;
    light.shadowCameraNear = 10;
    light.shadowCameraFar = 200;

    var light2 = new THREE.DirectionalLight(0xFFFFFF,1);
    light2.position.set(1200, 3000, 1000);
    light2.castShadow = true;
    light2.shadowMapDebug = true;
    light2.shadowCameraNear = 10;
    light2.shadowCameraFar = 200;


    scene.add(light);
    //scene.add(light2);


    var meshes = [];


    createGround();
    createCube();
    
    car = createCar();

    //camera.lookAt(new THREE.Vector3( car.position.x,car.position.y,car.position.z));
    createModel();
    velocity = -2;
    wheelAngle = 0.3;

/*    //控制鼠标视觉角度
    clock = new THREE.Clock();
    rollControls = new THREE.RollControls(camera);
    rollControls.movementSpeed = 0;
    rollControls.lookSpeed = 1;
*/
/*
   //orbitControls
    clock = new THREE.Clock();
    orbitControls = new THREE.OrbitControls(camera);
    orbitControls.autoRotate = false;
    //delta = clock.getDelta();
    //orbitControls.update(delta);
*/

    //var mouseX,mouseY;
    document.addEventListener( 'mousemove', onDocumentMouseMove, false );
    window.addEventListener( 'resize', onWindowResize, false );


    
    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );
    }
    
    function onDocumentMouseMove( event ) {

        mouseX = ( event.clientX - windowHalfX ) * 0.2;
        mouseY = -( event.clientY - windowHalfY ) * 0.2;

        //camera.position.x += ( mouseX - camera.position.x ) * .05;
        //camera.position.y += ( - mouseY - camera.position.y ) * .05;
        //camera.lookAt.x+= ( mouseX - camera.position.x ) * .05;
        //camera.lookAt.y += ( - mouseY - camera.position.y ) * .05;
        //requestAnimationFrame(render);
    }

    scene.addEventListener(
                'update',
                function() {

                    if ( input && vehicle ) {
                        if ( input.direction !== null ) {
                            input.steering += input.direction / 100;
                            if ( input.steering < -.6 ) input.steering = -.6;
                            if ( input.steering > .6 ) input.steering = .6;
                        }
                        vehicle.setSteering( input.steering, 2 );
                        vehicle.setSteering( input.steering, 3 );

                        if ( input.power === true ) {
                            input.velocity += input.vsize;
                            if(input.velocity>input.vmax) input.velocity = input.vmax;
                            vehicle.applyEngineForce( input.velocity );
                        } else if ( input.power === false ) {
                            if(input.velocity > 0){
                                // vehicle.setBrake( 20, 2 );
                                // vehicle.setBrake( 20, 3 ); 
                                vehicle.applyEngineForce( 0 ); 
                                input.velocity = 0;   
                                console.log("backward,"+input.velocity);                       
                            }else{
                                input.velocity -= input.vsize;
                                if(input.velocity<-input.vmax) input.velocity = -input.vmax;
                                vehicle.applyEngineForce( input.velocity );                                
                            }

                        } else{
                            vehicle.applyEngineForce(0);
                            input.velocity = 0;
                        }

                        if(input.brake == true){
                            vehicle.setBrake( 40, 2 );
                            vehicle.setBrake( 40, 3 ); 
                            vehicle.applyEngineForce( 0 );
                            input.velocity = 0;
                        }
                    }
                    //console.log('update');
                    scene.simulate( undefined, 2 );
                }
            );
    
    requestAnimationFrame(render);
    scene.simulate();

};



function createCar() {
    var loader = new THREE.JSONLoader();
     loader.load( "car_1.js", function( car, car_materials ) {
                loader.load( "car_1_wheel.js", function( wheel, wheel_materials ) {
                    loader.load( "car_1_wheel_r2.js", function( wheel_r, wheel_r_materials ) {
                        var mesh = new Physijs.BoxMesh(
                            car,
                            new THREE.MeshFaceMaterial( car_materials ),
                            250
                        );
                        //mesh.position.y = 2;
                        //mesh.position.set(300,2,300);
                        //mesh.scale.set(5,5,5);
                        mesh.castShadow = mesh.receiveShadow = true;

                        vehicle = new Physijs.Vehicle(mesh, new Physijs.VehicleTuning(
                            10.88,
                            1.83,
                            0.28,
                            500,
                            10.5,
                            8000
                        ));
                        vehicle.mesh.position.set(300,20,240);
     //                   vehicle.mesh.scale.set(2,2,2);
                        scene.add( vehicle );

                        window.vehicle = vehicle;
                        window.scene = scene;

                        var wheel_material = new THREE.MeshFaceMaterial( wheel_materials );
                        var wheel_r_material = new THREE.MeshFaceMaterial(wheel_r_materials);
                        //
                        // 0, bl,
                        // 1, br,
                        // 2, fl,
                        // 3, fr,
                        for ( var i = 0; i < 4; i++ ) {
                            vehicle.addWheel(
                                //wheel,
                                i % 2 === 0 ?wheel:wheel_r,
                                //wheel_material,
                                i % 2 === 0 ?wheel_material:wheel_r_material,
                                new THREE.Vector3(
                                        i % 2 === 0 ? -16 : 16,
                                        -12,
                                        i < 2 ? 28 : -28
                                ),
                                new THREE.Vector3( 0, -1, 0 ),
                                new THREE.Vector3( 
                                    //i%2 === 0?-1:1, 
                                    -1,
                                    0, 
                                    0 
                                ),
                                3,
                                6,
                                i < 2 ? false : true
                            );
                            // for(var v in vehicle.wheels)
                            // {
                            //     console.log(v);
                            // }
                            //ttt.scale.set(5,5,5);
                            //vehicle.addWheel.wheel.scale.set(5,5,5);
                        }

                        input = {
                            power: null,
                            velocity:0,
                            vsize:200,
                            vmax:2000,
                            brake: null,
                            direction: null,
                            steering: 0
                        };
                        document.addEventListener('keydown', function( ev ) {
                            switch ( ev.keyCode ) {
                                case 37: // left
                                case 65: /*A*/
                                    input.direction = 1;
                                    break;

                                case 38: // forward
                                case 87: /*W*/
                                    input.power = false;
                                    break;

                                case 39: // right
                                case 68: /*D*/
                                    input.direction = -1;
                                    break;

                                case 40: // back
                                case 83: /*S*/
                                    input.power = true;
                                    break;
                                case 32: /*space*/
                                    console.log('brake!brake!');
                                    input.brake = true;
                                    break;    
                            }
                        });
                        document.addEventListener('keyup', function( ev ) {
                            switch ( ev.keyCode ) {
                                case 37: // left
                                case 65: /*A*/
                                    input.direction = null;
                                    break;

                                case 38: // forward
                                case 87: /*W*/
                                    input.power = null;
                                    break;

                                case 39: // right
                                case 68: /*D*/
                                    input.direction = null;
                                    break;

                                case 40: // back
                                case 83: /*S*/
                                    input.power = null;
                                    break;
                                case 32: /*space*/
                                    input.brake = false;
                            }
                        });
                    });
                });

            });
    //return mesh;
       
}


function createGround() {
    var length = 600;
    var width = 600;
    // Materials
   var PlaneGeo = new THREE.PlaneGeometry(length, width, 1, 1);
    //var material_Plane= new THREE.MeshLambertMaterial({color: 0xFFFFFF});
    var maxAnisotropy = renderer.getMaxAnisotropy();

    var texture1 = THREE.ImageUtils.loadTexture( "ground_05.jpg" );
    var ground_material = Physijs.createMaterial(new THREE.MeshPhongMaterial( { color: 0xffffff, map: texture1 } ),0.9,0.3) ;
    texture1.anisotropy = maxAnisotropy;
    texture1.wrapS = texture1.wrapT = THREE.RepeatWrapping;
    texture1.repeat.set( 6, 6 );
    
    //ground01
    var ground01 = new Physijs.BoxMesh(PlaneGeo, ground_material,0); 
        ground01.rotation.x = -0.5 * Math.PI;
    ground01.position.set(300,0,300);
    ground01.receiveShadow = true;
    
    //ground02
    var ground02 = new Physijs.BoxMesh(PlaneGeo, ground_material,0); 
        ground02.rotation.x = -0.5 * Math.PI;
    ground02.position.set(900,0,300);
    ground02.receiveShadow = true;

    //ground03
    var ground03 = new Physijs.BoxMesh(PlaneGeo, ground_material,0); 
        ground03.rotation.x = -0.5 * Math.PI;
    ground03.position.set(300,0,-300);
    ground03.receiveShadow = true;

    //ground04
    var ground04 = new Physijs.BoxMesh(PlaneGeo, ground_material,0); 
        ground04.rotation.x = -0.5 * Math.PI;
    ground04.position.set(900,0,-300);
    ground04.receiveShadow = true;

    //ground05
    var ground05 = new Physijs.BoxMesh(PlaneGeo, ground_material,0); 
        ground05.rotation.x = -0.5 * Math.PI;
    ground05.position.set(300,0,900);
    ground05.receiveShadow = true;

    //ground06
    var ground06 = new Physijs.BoxMesh(PlaneGeo, ground_material,0); 
        ground06.rotation.x = -0.5 * Math.PI;
    ground06.position.set(900,0,900);
    ground06.receiveShadow = true;

    //ground07
    var ground07 = new Physijs.BoxMesh(PlaneGeo, ground_material,0); 
        ground07.rotation.x = -0.5 * Math.PI;
    ground07.position.set(-300,0,300);
    ground07.receiveShadow = true;

    //ground08
    var ground08 = new Physijs.BoxMesh(PlaneGeo, ground_material,0); 
        ground08.rotation.x = -0.5 * Math.PI;
    ground08.position.set(-300,0,900);
    ground08.receiveShadow = true;

    var ground09 = new Physijs.BoxMesh(PlaneGeo, ground_material,0); 
        ground09.rotation.x = -0.5 * Math.PI;
    ground09.position.set(-300,0,-300);
    ground09.receiveShadow = true;
    
    scene.add(ground01);
    scene.add(ground02);
    scene.add(ground03);
    scene.add(ground04);
    scene.add(ground05);
    scene.add(ground06);
    scene.add(ground07);
    scene.add(ground08);
    scene.add(ground09);
}

function createCube(){
    //var cubeSize = Math.ceil((Math.random() * 10));
    //var geometry = new THREE.CubeGeometry( cubeSize, cubeSize, cubeSize );
    var geometry = new THREE.CubeGeometry( 6, 6, 6 );
    //var material_cube = Physijs.createMaterial(new THREE.MeshLambertMaterial( { color: scale(Math.random()).hex(),} ),0.3,0);
    var cube = [];
    var i =0;
    for (; i <= 24; i++) {
        cube[i] = getCube(i);
        scene.add(cube[i]);
    };
    function getCube(){
        var material_cube = Physijs.createMaterial(new THREE.MeshLambertMaterial( { color: scale(Math.random()).hex(),} ),0.3,0);
        cube[i] = new Physijs.BoxMesh(geometry, material_cube);
        //cube[i].rotation.set(0,0,0); 
        var vz = i % 5;
        var vy = i / 5;
        cube[i].position.set(850,4+6*vy,300+6*vz);   
        cube[i].__dirtyRotation = true;
        return cube[i];
    };
}



function createModel(){
    ////////////////////////////////////////ground01//////////////////////////////////////////

    //房子9_3
    var loader_house9_3 = new THREE.JSONLoader(true);
    var house9_3;
    loader_house9_3.load("house9_3.js", function ( geometry,materials ) {
        //var loading = document.getElementById("Loading");
        //loading.parentNode.removeChild(loading);
        
        //var material_car1 = Physijs.createMaterial(new THREE.MeshLambertMaterial({color: 0xFF0000}),0.8,0.3); 
        //var   mesh = new THREE.SkinnedMesh(geometry, mat);
        //obj1 = new Physijs.BoxMesh(geometry, material_car1,500);

        house9_3 = new Physijs.BoxMesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        //var house1_2 = new Physijs.BoxMesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        house9_3.position.set(550,120,350);
        house9_3.rotation.y = 0.45 * Math.PI;
        house9_3.scale.set(350,350,350);
        //house9_3.scale.set(1,1,1);

        //scene.add(house9_3);
        scene.add(house9_3);
        //addObj(obj);
        //scene.add(mat);
    });

     //喷泉fountain01
    var loader_fountain01 = new THREE.JSONLoader(true);
    var fountain01;
    loader_fountain01.load("fountain01.js", function ( geometry,materials) {
        fountain01 = new Physijs.Mesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        fountain01.position.set(250,0,400);
        //fountain01.rotation.y =  -0.5 * Math.PI;
        fountain01.scale.set(0.01,0.01,0.01);
        scene.add(fountain01);
        //scene.add(fountain01);
    });


    //汽车module_car4，很好，可用来控制
    var loader_module_car4 = new THREE.JSONLoader(true);
    var module_car4;
    var module_car4_2;//ground07中的一辆车
    loader_module_car4.load("module_car4.js", function ( geometry,materials) {
        module_car4 = new Physijs.Mesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        module_car4.position.set(250,0,250);
        module_car4.rotation.y = - 0.5 * Math.PI;
        module_car4.scale.set(0.05,0.05,0.05);
        scene.add(module_car4);
        //scene.add(module_car4);
        obj_model.push(module_car4);

        module_car4_2 = new Physijs.Mesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        module_car4_2.position.set(-350,0,150);
        module_car4_2.rotation.y = 0.5 * Math.PI;
        module_car4_2.scale.set(0.05,0.05,0.05);
        scene.add(module_car4_2);
        obj_model.push(module_car4_2);
    });

    ///////////////////////////////ground02//////////////////////////////////////////////////

    //小草tree4_5
    var loader_tree4_5 = new THREE.JSONLoader(true);
    var tree4_5,tree4_5_2;//两棵小草
    var tree4_5_3,tree4_5_4;//两棵小草，是ground04的
    loader_tree4_5.load("tree4_5.js", function ( geometry) {
        tree4_5 = new Physijs.BoxMesh(geometry, new THREE.MeshLambertMaterial({color: 0x003300}) ,9500);
        tree4_5.position.set(900,20,150);
        tree4_5.scale.set(0.5,0.5,0.5);
        scene.add(tree4_5);
        scene.add(tree4_5);

        //第二颗小草
        tree4_5_2 = new Physijs.BoxMesh(geometry, new THREE.MeshLambertMaterial({color: 0x003300}) ,9500);
        tree4_5_2.position.set(900,20,50);
        tree4_5_2.scale.set(0.5,0.5,0.5);
        scene.add(tree4_5_2);
        scene.add(tree4_5_2);

        //第三颗小草
        tree4_5_3 = new Physijs.BoxMesh(geometry, new THREE.MeshLambertMaterial({color: 0x003300}) ,9500);
        tree4_5_3.position.set(850,20,-350);
        tree4_5_3.scale.set(0.5,0.5,0.5);
        scene.add(tree4_5_3);
        scene.add(tree4_5_3);

        //第四颗小草
        tree4_5_4 = new Physijs.BoxMesh(geometry, new THREE.MeshLambertMaterial({color: 0x003300}) ,9500);
        tree4_5_4.position.set(750,20,-450);
        tree4_5_4.scale.set(0.5,0.5,0.5);
        scene.add(tree4_5_4);
        scene.add(tree4_5_4);
    });

    //房子house18，大办公楼
    var loader_house18 = new THREE.JSONLoader(true);
    var house18;
    loader_house18.load("house18.js", function ( geometry,materials) {
        house18 = new Physijs.Mesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        house18.position.set(1000,0,-200);
        house18.rotation.y =  -0.5 * Math.PI;
        house18.scale.set(1,1,1);
        scene.add(house18);
        //scene.add(house18);
    });


    ///////////////////////////////ground03//////////////////////////////////////////////////
   //树林tree01
    var loader3 = new THREE.JSONLoader(true);
    var obj3;
    loader3.load("tree01.js", function ( geometry ,materials) {

       var tree_1 = new Array();
       for(var i = 0;i<3;i++){
            tree_1[i] = new Array();
       };
       
        for (var i = 0; i < 3; i++) {
            for (var j = 0; j < 5; j++){
                // tree_1[i][j] = new Physijs.BoxMesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
                 tree_1[i][j] = new Physijs.BoxMesh(geometry, new THREE.MeshLambertMaterial({color:0x002200}),9500);
                //tree_2[i][j] = tree_1[i][j];
                tree_1[i][j].position.set(200+55*j,10,-500-55*i);
                tree_1[i][j].scale.set(0.09,0.09,0.09);
                scene.add(tree_1[i][j]);
                scene.add(tree_1[i][j]);
            };

        };
    });

    //路灯streetlight1
    var loader_streetlight1 = new THREE.JSONLoader(true);
    var streetlight1,streetlight1_2;//两只路灯
    var streetlight1_3,streetlight1_4;//ground08中的两只路灯
    loader_streetlight1.load("streetlight1.js", function ( geometry,materials) {
        streetlight1 = new Physijs.Mesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        streetlight1.position.set(290,0,-50);
        //people01.rotation.y =  -0.5 * Math.PI;
        streetlight1.scale.set(0.2,0.2,0.2);
        scene.add(streetlight1);
        //scene.add(streetlight1);

         streetlight1_2 = new Physijs.Mesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        streetlight1_2.position.set(360,0,-50);
        //people01_2.rotation.y =  -0.5 * Math.PI;
        streetlight1_2.scale.set(0.2,0.2,0.2);
        scene.add(streetlight1_2);
        //scene.add(streetlight1_2);

        streetlight1_3 = new Physijs.Mesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        streetlight1_3.position.set(-250,0,250);
        //people01_3.rotation.y =  -0.5 * Math.PI;
        streetlight1_3.scale.set(0.2,0.2,0.2);
        scene.add(streetlight1_3);
        //scene.add(streetlight1_3);

        streetlight1_4 = new Physijs.Mesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        streetlight1_4.position.set(-250,0,350);
        //people01_4.rotation.y =  -0.5 * Math.PI;
        streetlight1_4.scale.set(0.2,0.2,0.2);
        scene.add(streetlight1_4);
        //scene.add(streetlight1_4);
    });

    //房子house15
    var loader_house15 = new THREE.JSONLoader(true);
    var house15;
    loader_house15.load("house15.js", function ( geometry,materials) {
        house15 = new Physijs.Mesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        house15.position.set(300,0,-200);
        house15.rotation.y =  Math.PI;
        house15.scale.set(0.2,0.2,0.2);
        scene.add(house15);
        //scene.add(house15);
    });



    ///////////////////////////////ground04/////////////////////////////
    //房子house23
    var loader_house23 = new THREE.JSONLoader(true);
    var house23;
    loader_house23.load("house23.js", function ( geometry,materials) {
        house23 = new Physijs.Mesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        house23.position.set(850,0,-500);
        house23.rotation.y =  -0.5 * Math.PI;
        house23.scale.set(0.3,0.25,0.3);
        scene.add(house23);
        //scene.add(house23);
    });

    //有两棵小草，在ground02中设置


    ///////////////////////////////ground05/////////////////////////
    //房子house20,很好
    var loader_house20 = new THREE.JSONLoader(true);
    var house20;
    loader_house20.load("house20.js", function ( geometry,materials) {
        house20 = new Physijs.Mesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        house20.position.set(100,0,1000);
        house20.rotation.y =  -0.5 * Math.PI;
        house20.scale.set(0.15,0.15,0.15);
        scene.add(house20);
        //scene.add(house20);
    });


//////////////////////////////////////////ground06/////////////////////////////////
    //房子house21,很好
    var loader_house21 = new THREE.JSONLoader(true);
    var house21;
    loader_house21.load("house21.js", function ( geometry,materials) {
        house21 = new Physijs.Mesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        house21.position.set(750,0,850);
        house21.rotation.y =  -0.5 * Math.PI;
        house21.scale.set(0.1,0.1,0.1);
        scene.add(house21);
        //scene.add(house21);
    });

    ///////////////////////////////////ground07//////////////////////////

    //房子house24
    var loader_house24 = new THREE.JSONLoader(true);
    var house24;
    loader_house24.load("house24.js", function ( geometry,materials) {
        house24 = new Physijs.Mesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        house24.position.set(-400,0,350);
        house24.rotation.y =  Math.PI;
        house24.scale.set(0.15,0.15,0.2);
        scene.add(house24);
    });
    //两只路灯，在ground03中设置
    //一辆汽车，在ground01中设置


    //////////////////////////////////ground08///////////////////////
    //house10，单一颜色
    var loader_house10 = new THREE.JSONLoader(true);
    var house10;
    loader_house10.load("house10.js", function ( geometry,materials) {
        house10 = new Physijs.BoxMesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        house10.position.set(-350,50,950);
        house10.rotation.y =  -0.5 * Math.PI;
        house10.scale.set(0.2,0.2,0.2);
        scene.add(house10);
        scene.add(house10);
    });


    //////////////////////////////////ground08///////////////////////
    //房子house12_1，单一颜色
    var loader_house12_1 = new THREE.JSONLoader(true);
    var house12_1;
    loader_house12_1.load("house12_1.js", function ( geometry,materials) {
        house12_1 = new Physijs.BoxMesh(geometry, new THREE.MeshFaceMaterial(materials),9500);
        house12_1.position.set(-300,50,-500);
        //house12_1.rotation.y =  -0.5 * Math.PI;
        house12_1.scale.set(0.1,0.1,0.1);
        scene.add(house12_1);
        scene.add(house12_1);
    });

}

var num = 0;
render = function () {
    //控制camera跟踪车走
    if(vehicle){
        camera.position.set(vehicle.mesh.position.x -30-mouseX,vehicle.mesh.position.y+100-mouseY,vehicle.mesh.position.z-30);
        //camera.position.set(car.position.x -130-mouseX,car.position.y+900-mouseY,car.position.z-130);
        //camera.position.set(car.position.x +20,car.position.y+50,car.position.z+20);
        camera.lookAt(new THREE.Vector3( vehicle.mesh.position.x,vehicle.mesh.position.y,vehicle.mesh.position.z));
    }

   /* //控制鼠标视觉角度
    delta = clock.getDelta();
    rollControls.update(delta);
    //orbitControls.update(delta);*/
/*
    if(camera.position.x <= -60 && num == 0){
        createModel();
        num++;
    }
    */


/*    //射线
    var raycaster = new THREE.Raycaster( car.position, vector.sub( camera.position ).normalize() );
    var intersects = raycaster.intersectObjects( objects );

                if ( intersects.length > 0 ) {
    */
    requestAnimationFrame(render);
    renderer.render(scene, camera);
    render_stats.update();
    scene.simulate(undefined, 2);
};


window.onload = initScene;

</script>
</head>

<body>
<div id="viewport"></div>
</body>

</html>
